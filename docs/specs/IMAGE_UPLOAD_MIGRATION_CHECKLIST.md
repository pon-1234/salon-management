# 画像アップロード永続化 移行チェックリスト

## 実装前の準備

- [ ] Vercelアカウントでプロジェクトを確認
- [ ] 現在の画像使用量を確認（`du -sh public/uploads`）
- [ ] バックアップを作成（`cp -r public/uploads public/uploads.backup`）

## 実装手順

### Phase 1: 基本実装（新規アップロードのみ）

- [ ] `@vercel/blob`パッケージをインストール
- [ ] Vercel Blob Storageを有効化
- [ ] 環境変数`BLOB_READ_WRITE_TOKEN`を設定
- [ ] `/api/upload/route.ts`を更新
- [ ] ローカル環境でテスト
- [ ] ステージング環境でテスト

### Phase 2: 既存画像の移行（オプション）

- [ ] 移行スクリプトを作成
- [ ] 移行対象の画像リストを作成
- [ ] テスト環境で移行を実行
- [ ] データベースのURL更新ロジックを実装
- [ ] 本番環境で移行を実行

### Phase 3: 検証とクリーンアップ

- [ ] すべての画像が正しく表示されることを確認
- [ ] アップロード機能が正常に動作することを確認
- [ ] エラーログを確認
- [ ] 古いローカル画像を削除（確認後）

## テストケース

### アップロードテスト

- [ ] JPEG画像のアップロード
- [ ] PNG画像のアップロード
- [ ] WebP画像のアップロード
- [ ] 5MB制限のテスト
- [ ] 不正なファイル形式のテスト

### 表示テスト

- [ ] キャストプロフィール画像の表示
- [ ] 複数画像の表示
- [ ] 画像削除後の表示

## 監視項目

- [ ] Vercel Blob Storageの使用量
- [ ] アップロードエラー率
- [ ] 画像読み込み速度

## ロールバック計画

- [ ] 旧実装のコードを保持
- [ ] 環境変数で切り替え可能にする
- [ ] バックアップからの復元手順を文書化

## 完了基準

- [ ] すべての新規アップロードがBlobに保存される
- [ ] 既存画像がすべて移行完了（オプション）
- [ ] パフォーマンステスト合格
- [ ] 1週間の本番稼働で問題なし
